# Система Учета Финансов "Финансы" (DDS-Service by Trushin)

Простое веб-приложение для ведения учета доходов и расходов, управления статьями ДДС, счетами и транзакциями. Включает импорт банковских выписок и базовую аналитику.

## Особенности

* **Управление финансами:**
    * Иерархический справочник статей ДДС (доходы/расходы).
    * Управление счетами и кассами (разные валюты, начальные/текущие остатки).
    * Ручной ввод транзакций.
    * Редактирование (категории) и удаление транзакций с пересчетом балансов.
* **Автоматизация:**
    * Импорт банковских выписок из CSV (формат Т-Банка).
    * Автоматическая классификация импортированных транзакций по ключевым словам (настраивается через JSON).
    * Интерактивное сопоставление статей ДДС для нераспознанных операций после импорта.
    * Проверка на дубликаты при импорте.
* **Аналитика и Отчетность:**
    * Отчет о Движении Денежных Средств (ДДС).
    * Отчет об Остатках денежных средств.
    * Дашборд с KPI и графиком динамики денежных потоков.
    * Детализация (Drill-down) из отчетов на список транзакций.
* **Управление Пользователями и Ролями:**
    * Регистрация и аутентификация пользователей (JWT).
    * Роли "Администратор" и "Сотрудник".
    * Админ-панель для управления пользователями (список, создание, редактирование статуса/роли, деактивация).
    * (Бэкенд) CRUD для управления ролями (защищен админом).
* **Технологический стек:**
    * **Бэкенд:** Python, FastAPI, SQLAlchemy, PostgreSQL, Pydantic.
    * **Фронтенд:** React, Vite, Tailwind CSS, Headless UI, react-router-dom, date-fns, react-chartjs-2.
* **Другое:**
    * Адаптивный дизайн.
    * Защита API с использованием токенов.

## Структура проекта

money_flow_app/
├── backend/        # Папка с кодом бэкенда (FastAPI)
│   ├── app/        # Основное приложение FastAPI
│   │   ├── init.py
│   │   ├── auth_utils.py
│   │   ├── crud.py
│   │   ├── database.py
│   │   ├── main.py
│   │   ├── models.py
│   │   └── schemas.py
│   ├── alembic/    # (Если будете использовать Alembic для миграций)
│   ├── venv/       # (Виртуальное окружение, должно быть в .gitignore)
│   ├── .env        # (Переменные окружения, должен быть в .gitignore)
│   ├── dds_keyword_mapping_rules.json # Правила для импорта
│   └── requirements.txt
├── frontend/       # Папка с кодом фронтенда (React + Vite)
│   ├── public/
│   ├── src/
│   │   ├── assets/
│   │   ├── components/
│   │   ├── contexts/
│   │   ├── layouts/
│   │   ├── pages/
│   │   ├── App.jsx
│   │   ├── index.css
│   │   └── main.jsx
│   ├── .env.example # Пример файла переменных окружения
│   ├── index.html
│   ├── package.json
│   ├── postcss.config.js
│   ├── tailwind.config.js
│   └── vite.config.js
├── .gitignore      # Файл для исключения файлов/папок из Git
└── README.md       # Этот файл


## Установка и Запуск

### Предварительные требования

* Python 3.8+
* Node.js (например, v18+) и npm/yarn
* PostgreSQL сервер

### Бэкенд

1.  Перейдите в папку `backend`:
    ```bash
    cd backend
    ```
2.  Создайте и активируйте виртуальное окружение:
    ```bash
    python3 -m venv venv
    source venv/bin/activate
    ```
3.  Установите зависимости:
    ```bash
    pip install -r requirements.txt
    ```
4.  Создайте файл `.env` на основе `.env.example` (если есть) и настройте подключение к вашей базе PostgreSQL (переменная `DATABASE_URL`), а также `SECRET_KEY` и `ALGORITHM` для JWT.
    Пример `DATABASE_URL`: `postgresql://user:password@host:port/database_name`
5.  Убедитесь, что база данных создана в PostgreSQL.
6.  (Опционально, если таблицы не создались автоматически при первом запуске) Запустите Python и выполните для создания таблиц:
    ```python
    from app.database import Base, engine
    Base.metadata.create_all(bind=engine)
    ```
7.  Запустите Uvicorn сервер (из папки `backend`):
    ```bash
    uvicorn app.main:app --reload
    ```
    Бэкенд будет доступен на `http://localhost:8000`. Документация API: `http://localhost:8000/docs`.

### Фронтенд

1.  Перейдите в папку `frontend`:
    ```bash
    cd frontend
    ```
2.  Установите зависимости:
    ```bash
    npm install 
    # или yarn install
    ```
3.  (Опционально) Создайте файл `.env.local` для переменных окружения фронтенда, если они нужны (например, `VITE_API_BASE_URL=http://localhost:8000`).
4.  Запустите Vite dev server:
    ```bash
    npm run dev
    # или yarn dev
    ```
    Фронтенд будет доступен на `http://localhost:5173` (или другом порту, указанном Vite).

## Основные эндпоинты API (Бэкенд)

* **Аутентификация:**
    * `POST /auth/token`: Получение JWT токена.
* **Пользователи:**
    * `POST /users/`: Регистрация нового пользователя.
    * `GET /users/me/`: Получение данных текущего пользователя.
    * `GET /users/`: Получение списка всех пользователей (только для админа).
    * `PUT /users/{user_id}`: Обновление пользователя (только для админа).
    * `DELETE /users/{user_id}`: Удаление/деактивация пользователя (только для админа).
* **Роли:**
    * `POST /roles/`: Создание роли (только для админа).
    * `GET /roles/`: Получение списка ролей (только для админа).
    * ... (другие CRUD для ролей)
* **Статьи ДДС:**
    * `POST /articles/`
    * `GET /articles/`
    * ... (другие CRUD)
* **Счета:**
    * `POST /accounts/`
    * `GET /accounts/`
    * ... (другие CRUD)
* **Транзакции:**
    * `POST /transactions/`
    * `GET /transactions/` (с фильтрами и пагинацией)
    * `PATCH /transactions/{transaction_id}/` (для частичного обновления)
    * `PUT /transactions/{transaction_id}/` (для полного обновления)
    * `DELETE /transactions/{transaction_id}/`
* **Импорт Выписок:**
    * `POST /statements/upload/tinkoff-csv/`
    * `POST /transactions/batch-categorize/`
* **Отчеты:**
    * `GET /reports/dds/`
    * `GET /reports/account-balances/`
* **Дашборд:**
    * `GET /dashboard/kpis`
    * `GET /dashboard/cashflow-trend`

## Дальнейшее развитие (TODO)

* Полноценное разграничение прав на основе ролей и `permissions`.
* UI для управления ролями и их правами.
* Справочник Контрагентов.
* Улучшение механизма сопоставления статей ДДС при импорте (UI для правил, обучение).
* Поддержка других форматов банковских выписок / ОФД.
* Обработка конвертации валют.
* Более детальные отчеты и виджеты для дашборда.
* Тесты (unit, integration).
* Деплоймент.